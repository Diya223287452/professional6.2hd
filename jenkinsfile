pipeline {
    agent any
    
    environment {
        // Specify your environment variables
        NODE_ENV = 'production'
    }

    stages {
        // Checkout the repository
        stage('Checkout') {
            steps {
                // Clone the repository containing the React app
                git 'https://github.com/your-repo/weather-app.git'  // Replace with your repo URL
            }
        }

        // Install dependencies and build the React application
        stage('Install & Build') {
            steps {
                script {
                    // Install npm dependencies and build the application
                    sh 'npm install'
                    sh 'npm run build'
                }
            }
        }

        // Run tests if you have any set up (e.g., Jest tests)
        stage('Test') {
            steps {
                script {
                    // Run npm tests
                    sh 'npm test'
                }
            }
        }

        // Archive build artifacts
        stage('Archive Artifacts') {
            steps {
                archiveArtifacts artifacts: 'build/**', allowEmptyArchive: true
            }
        }

        // Deploy stage (this example is for a simple S3 bucket or Docker deployment)
        stage('Deploy') {
            steps {
                script {
                    echo "Deploying the application..."
                    // You can replace this with your own deployment process, e.g., AWS S3, Docker, or a server copy
                    // Example for Docker:
                    // sh 'docker build -t weather-app .'
                    // sh 'docker run -d -p 3000:3000 weather-app'
                }
            }
        }
    }

    post {
        success {
            echo 'Pipeline executed successfully.'
        }
        failure {
            echo 'Pipeline failed. Check logs.'
        }
    }
}
